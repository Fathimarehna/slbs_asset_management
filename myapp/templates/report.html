
{% extends 'base.html' %}
{% block content %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Asset Report</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        body { font-family: Arial;  }
        form { margin-bottom: 20px; display: flex; flex-wrap: wrap; gap: 10px; align-items: center; }
        label { font-weight: bold; }
        select, input { padding: 5px; }
        button { padding: 5px 10px; background-color: #007bff; color: white; border: none; cursor: pointer; border-radius: 4px; }
        button:hover { background-color: #0056b3; }
        table { border-collapse: collapse; width: 100%; margin-top: 15px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f5f5f5; }
    </style>
</head>
<body>
    <h2 class="text-center fw-bold mb-5">Asset Report</h2>

    <form method="get">
        <!-- Category -->
        <label>Category:</label>
        <select name="category" id="category">
            <option value="">All</option>
            {% for c in categories %}
            <option value="{{ c.id }}" {% if request.GET.category == c.id|stringformat:"s" %}selected{% endif %}>{{ c.title }}</option>
            {% endfor %}
        </select>

        <!-- Subcategory -->
        <label>Subcategory:</label>
<select name="subcategory" id="subcategory">
    <option value="">All</option>
    {% for s in subcategories %}
    <option value="{{ s.id }}" {% if request.GET.subcategory == s.id|stringformat:"s" %}selected{% endif %}>{{ s.title }}</option>
    {% endfor %}
</select>

        <!-- Location -->
        <label>Location:</label>
        <select name="location">
            <option value="">All</option>
            {% for l in locations %}
            <option value="{{ l.id }}" {% if request.GET.location == l.id|stringformat:"s" %}selected{% endif %}>{{ l.location  }}</option>
            {% endfor %}
        </select>

        <!-- Department -->
        <label>Department:</label>
        <select name="department">
            <option value="">All</option>
            {% for d in departments %}
            <option value="{{ d.id }}" {% if request.GET.department == d.id|stringformat:"s" %}selected{% endif %}>{{ d.title }}</option>
            {% endfor %}
        </select>

        <!-- Condition -->
        <label>Condition:</label>
        <select name="condition">
            <option value="">All</option>
            {% for c,v in conditions %}
            <option value="{{ c }}" {% if request.GET.condition == c %}selected{% endif %}>{{ v }}</option>
            {% endfor %}
        </select>

        <!-- Date Range -->
        
       <div style="width: 100%; margin-top: 10px;">
    <label>Purchase Date From:</label>
    <input type="date" name="date_from" value="{{ request.GET.date_from }}" style="margin-right: 20px;">
    <label>To:</label>
    <input type="date" name="date_to" value="{{ request.GET.date_to }}">
     <button type="submit">Filter</button>
</div>


       
    </form>

    <!-- Asset Table -->
    <table>
        <tr>
            <th>Asset Name</th>
            <th>Category</th>
            <th>Subcategory</th>
            <th>Department</th>
            <th>Location</th>
            <th>Condition</th>
            <th>Purchase Date</th>
            <th>Warranty Expiry</th>
            <th>Assigned To</th>
            <th>Remarks</th>
        </tr>
        {% for a in assets %}
        <tr>
            <td>{{ a.assetname }}</td>
            <td>{{ a.category }}</td>
            <td>{{ a.subcategory }}</td>
            <td>{{ a.department }}</td>
            <td>{{ a.location }}</td>
            <td>{{ a.condition }}</td>
            <td>{{ a.purchase_date }}</td>
            <td>{{ a.warrenty_expiry }}</td>
            <td>{{ a.assigned_to }}</td>
            <td>{{ a.remarks }}</td>
        </tr>
        {% empty %}
        <tr><td colspan="10">No records found.</td></tr>
        {% endfor %}
    </table>

    <script>
        // Load subcategories dynamically when category changes
        $('#category').change(function() {
            var categoryId = $(this).val();
            $.ajax({
                url: "{% url 'ajax_load_subcategories' %}",
                data: {'category_id': categoryId},
                success: function(data) {
                    $("#subcategory").html('<option value="">All</option>');
                    $.each(data, function(index, subcat) {
                        $("#subcategory").append('<option value="' + subcat.id + '">' + subcat.title + '</option>');
                    });
                }
            });
        });
    </script>
</body>
</html>
{% endblock %}